<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Unwind - Home</title>

    <!-- Bootstrap CSS and Font Awesome for icons -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

    <style>
        /* ... existing styles ... */
        body {
            background-color: #f5f5f5;
            margin: 0;
            overflow: hidden;
        }
        .video-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        video {
            width: 100%;
            height: auto;
            min-height: 100%;
        }
        .action-buttons {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }
        .action-buttons button {
            display: block;
            margin-bottom: 15px;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        .action-buttons button:hover {
            opacity: 1;
        }
        .liked {
            color: red;
        }

        .comment-box {
            display: none;
            width: 250px;
            position: absolute;
            right: 20px;
            bottom: 20px;
            background: rgba(255, 255, 255, 0.7);
        }

        .comment-input {
            width: 100%;
        }

        .profile-pic-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%; 
            object-fit: cover;
        }
    </style>
</head>

<body>

    <div class="video-container">
        <video id="videoPlayer" autoplay muted loop>
            <!-- Displaying the first video. -->
            <source src="{{ video_path + video_files[0] }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <!-- Overlay buttons -->
        <div class="action-buttons">

            <button class="btn btn-lg btn-link" onclick="window.location.href='{{ url_for('profile') }}'">
                <img src="{{ url_for('static', filename='images/profile_pic/profile_pic_default.png') }}" alt="Profile Pic" class="profile-pic-icon">
            </button>
            <!-- Like icon with toggle behavior -->
            <button id="likeButton" class="btn btn-lg btn-link" onclick="toggleLike()">
                <i class="far fa-heart"></i>
            </button>
            <!-- Share icon -->
            <button class="btn btn-lg btn-link">
                <i class="fas fa-share-alt"></i>
            </button>
            <!-- Comment icon and comment box -->
            <button class="btn btn-lg btn-link" onclick="toggleCommentBox()">
                <i class="fas fa-comment"></i>
            </button>

            <button class="btn btn-lg btn-link" onclick="window.location.href='{{ url_for('logout') }}'">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>

        <!-- Comment Box -->
        <div class="comment-box p-3">
            <textarea class="comment-input form-control" placeholder="Add your comment..."></textarea>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- Bootstrap's JavaScript -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


    <script>
        // Array of video files (we can fetch this from the backend)
        const videoFiles = {{ video_files|tojson }};
        const videoPath = "{{ video_path }}";
        
        let currentVideoIndex = 0;
        const videoPlayer = document.getElementById('videoPlayer');

        document.addEventListener('keydown', function(event) {
            // If UP arrow is pressed
            if (event.keyCode == 38) {
                currentVideoIndex = (currentVideoIndex + 1) % videoFiles.length;
                changeVideo();
            }
            // If DOWN arrow is pressed
            else if (event.keyCode == 40) {
                currentVideoIndex = (currentVideoIndex - 1 + videoFiles.length) % videoFiles.length;
                changeVideo();
            }
        });

            // Initialize video states
        const videoStates = videoFiles.map(video => ({
            liked: false,
            comments: []
        }));

        function updateUIForCurrentVideo() {
            const currentState = videoStates[currentVideoIndex];
            const heartIcon = document.getElementById('likeButton').querySelector('i');
            const commentBox = document.querySelector('.comment-box');
            const commentInput = commentBox.querySelector('.comment-input');

            // Set like state
            if (currentState.liked) {
                heartIcon.classList.add('fas', 'liked');
                heartIcon.classList.remove('far');
            } else {
                heartIcon.classList.add('far');
                heartIcon.classList.remove('fas', 'liked');
            }

            // Set comments (for the sake of simplicity, we'll load the last comment)
            commentInput.value = currentState.comments.length ? currentState.comments[currentState.comments.length - 1] : '';
        }

        function toggleLike() {
            const currentState = videoStates[currentVideoIndex];
            currentState.liked = !currentState.liked;
            updateUIForCurrentVideo();
        }

        function addComment(comment) {
            const currentState = videoStates[currentVideoIndex];
            currentState.comments.push(comment);
        }

        function toggleCommentBox() {
            const commentBox = document.querySelector('.comment-box');
            commentBox.style.display = commentBox.style.display === 'none' ? 'block' : 'none';
        }

        // Add an event listener for the textarea to capture and store the comment when it's being typed
        document.querySelector('.comment-input').addEventListener('keyup', function(event) {
            const comment = event.target.value.trim();
            if (comment) {
                addComment(comment);
            }
        });

        // Call updateUIForCurrentVideo in the changeVideo function so that the UI updates as you switch videos.
        function changeVideo() {
            videoPlayer.querySelector('source').setAttribute('src', videoPath + videoFiles[currentVideoIndex]);
            videoPlayer.load();
            videoPlayer.play();
            updateUIForCurrentVideo(); // Add this line
        }

        // Initially set the UI for the first video
        updateUIForCurrentVideo();


    </script>
</body>

</html>
